<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Wangbinghua"><title>类比servlet请求处理和java多线程处理 · 年华未央</title><meta name="description" content="Jvm的运行内存模型中，每一个线程拥有一个虚拟机栈，每一个线程执行方法时，一个栈帧压入到jvm内存模型的虚拟机栈中。而每一个栈帧针对一个方法，包含了局部变量表，返回地址，操作栈（将具体的方法翻译成指令），动态链接等。  
有一个java多线程的程序说明：
该类相当于一个任务类，开启的多个线程均需要执"><meta name="keywords" content="Hexo,HTML,CSS,android,Linux"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">年华未央</a></h3><div class="description"><p>不仅仅是程序员</p></div></div></div><ul class="social-links"><li><a href="http://weibo.com/wangbinghua91128"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/wbh91128"><i class="fa fa-github"></i></a></li></ul></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于博客</a></li><li><a href="/archives">时间线</a></li><li><a href="/links">友情链接</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>类比servlet请求处理和java多线程处理</a></h3></div><div class="post-content"><p>Jvm的运行内存模型中，每一个线程拥有一个虚拟机栈，每一个线程执行方法时，一个栈帧压入到jvm内存模型的虚拟机栈中。而每一个栈帧针对一个方法，包含了局部变量表，返回地址，操作栈（将具体的方法翻译成指令），动态链接等。  </p>
<p>有一个java多线程的程序说明：<br><img src="/2016/10/23/类比servlet请求处理和java多线程处理/2588290-f1c743702515b14a.png" alt="thread.png"></p>
<p>该类相当于一个任务类，开启的多个线程均需要执行任务类中的方法，从而完成任务的执行。</p>
<p><img src="/2016/10/23/类比servlet请求处理和java多线程处理/2588290-9edc9d44b7656c86.png" alt="1.png"></p>
<p>在线程执行任务的时候，只会有一个任务，只需要实例化任务类一次，在整个过程中只有一个任务类实例，因此对于所有的线程都共享同一个任务类实例，即PrintContentTask类的实例。根据jvm规范中的运行时内存模型，每一个线程都有一个虚拟机栈，对于每一个线程执行方法时，都将该方法抽象成栈帧数据结构，并且push到虚拟机栈中。因此线程执行的每一个方法中，方法内的变量都是线程安全的，因为都是线程在私有的，而不是所有的线程进行共享。</p>
<p>在java web中的servlet请求中，有这样的场景，多个用户去请求同一个jsp页面。这个jsp页面被tomcat server编译成 servlet文件（java文件）。而多个用户（即多个线程）请求该java文件，即相当于多个线程在执行任务，而这个任务类即为jsp对应的servlet.java。</p>
<p><img src="/2016/10/23/类比servlet请求处理和java多线程处理/2588290-7c4125e527425f5b.png" alt="2.png"></p>
<p>Tomcat Server中，只生成Servlet.java类的一个实例，而所有的用户请求（即用户线程）会共享这个servlet类的所有的成员变量，而用户请求时，需要执行的方法（即执行的任务）为servlet类中的_jspService() 方法。</p>
<p><img src="/2016/10/23/类比servlet请求处理和java多线程处理/2588290-6fa421764ff465a4.png" alt="3.png"></p>
<p>这就相当于在java的多线程编程时，所有的线程共享同一个任务类，这个任务类实现Runnable接口，而所有的线程在执行的任务，即为任务类的run方法。每一个线程分别执行run方法，因此run方法中定义的变量都是线程安全的。</p>
<p><img src="/2016/10/23/类比servlet请求处理和java多线程处理/2588290-bf0d892384b7b8db.png" alt="4.png"></p>
<p>因此，在请求每一个Servlet时，或者jsp页面时，相应的servlet java文件只会实例化一次，而多个用户（即多个线程）进行请求，只是调用servlet java文件中的相应的方法。相当于多个线程在执行一个任务，任务类只会初始化成一个任务类的实例，而多个用户线程在调用时，只是调用的任务类的run方法。</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2016-10-23</span><i class="fa fa-tag"></i><a class="tag" href="/tags/java-java-web-多线程-servlet/" title="java java-web 多线程 servlet">java java-web 多线程 servlet </a></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2016/10/26/Web容器启动后做点事儿/" title="Web容器启动后做点事儿">上一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>